<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BushBuddy</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#698167" />
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #f5f7fa 0%, #e7f5e4 100%); min-height: 100vh; }
.container { max-width: 1200px; margin: 0 auto; }
.header { text-align: center; margin-bottom: 30px; color: #657a6b; }
.header h1 { margin: 0; font-size: 2.5em; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }

/* Navigation Tabs - Enhanced */
.main-nav { 
  display: flex; 
  justify-content: center; 
  margin-bottom: 30px; 
  background: white; 
  border-radius: 15px; 
  padding: 15px 10px; 
  box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
  backdrop-filter: blur(10px);
  overflow-x: auto;
  scrollbar-width: none;
  -ms-overflow-style: none;
}
.main-nav::-webkit-scrollbar { display: none; }

.nav-tab { 
  padding: 12px 20px; 
  margin: 0 6px; 
  border: none; 
  background: transparent; 
  color: #666; 
  cursor: pointer; 
  border-radius: 12px; 
  transition: all 0.3s ease; 
  font-weight: 600; 
  position: relative; 
  overflow: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  min-width: 85px;
  white-space: nowrap;
  font-size: 12px;
}

.nav-tab .tab-icon {
  font-size: 18px;
  margin-bottom: 2px;
  transition: transform 0.3s ease;
}

.nav-tab .tab-text {
  font-size: 11px;
  font-weight: 600;
  text-align: center;
  line-height: 1.2;
}

.nav-tab:hover { 
  background: rgba(43,122,120,0.1); 
  color: #657a6b;
  transform: translateY(-2px);
}

.nav-tab:hover .tab-icon {
  transform: scale(1.1);
}

.nav-tab.active { 
  background: linear-gradient(135deg, #698167, #a0b2af); 
  color: white; 
  box-shadow: 0 4px 15px rgba(43,122,120,0.3);
  transform: translateY(-2px);
}

.nav-tab::before { 
  content: ''; 
  position: absolute; 
  top: 0; 
  left: -100%; 
  width: 100%; 
  height: 100%; 
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); 
  transition: left 0.5s; 
}
.nav-tab:hover::before { left: 100%; }

/* Card Styles */
.card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-bottom: 25px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
.card h2 { margin-top: 0; color: #698167; font-size: 1.8em; }
.card h3 { color: #698167; border-bottom: 2px solid #e8f5e9; padding-bottom: 10px; }

/* Form Elements */
label { display: block; margin-top: 15px; font-weight: 600; color: #555; }
input, select, textarea { width: 100%; padding: 12px; margin-top: 6px; border-radius: 10px; border: 2px solid #e1e8ed; box-sizing: border-box; transition: all 0.3s ease; font-size: 16px; }
input:focus, select:focus, textarea:focus { outline: none; border-color: #698167; box-shadow: 0 0 0 3px rgba(43,122,120,0.1); }
textarea { resize: vertical; min-height: 80px; }

/* Buttons */
button { margin: 8px 4px; padding: 12px 20px; border: none; border-radius: 10px; background: linear-gradient(135deg, #698167, #a0b2af); color: white; cursor: pointer; font-weight: 600; transition: all 0.3s ease; position: relative; overflow: hidden; }
button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(43,122,120,0.3); }
button:active { transform: translateY(0); }
button.secondary { background: linear-gradient(135deg, #6c757d, #7a8086); }
button.danger { background: linear-gradient(135deg, #dc3545, #e74c3c); }
button.small { padding: 8px 12px; font-size: 12px; margin: 2px; }
button::before { content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0; background: rgba(255,255,255,0.2); border-radius: 50%; transition: width 0.3s, height 0.3s; transform: translate(-50%, -50%); }
button:active::before { width: 300px; height: 300px; }

/* Photo Upload */
.photo-section { margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 15px; border: 2px dashed #dee2e6; text-align: center; }
.photo-preview { max-width: 200px; max-height: 200px; border-radius: 10px; margin: 10px; }
.photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 15px; }
.photo-item { position: relative; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
.photo-item img { width: 100%; height: 150px; object-fit: cover; }
.photo-item .photo-info { padding: 10px; font-size: 12px; color: #666; }
.photo-delete { position: absolute; top: 5px; right: 5px; background: rgba(220,53,69,0.9); color: white; border: none; border-radius: 50%; width: 25px; height: 25px; font-size: 12px; cursor: pointer; }

/* Content Sections */
.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* Animal List */
.animal-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
.animal-item { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 6px 25px rgba(0,0,0,0.1); position: relative; }
.animal-item h4 { margin-top: 0; color: #698167; }
.animal-actions { position: absolute; top: 15px; right: 15px; }

/* Results and Info Cards */
.result { margin-top: 15px; padding: 15px; border-radius: 12px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-left: 4px solid #698167; }
.info-card { margin-top: 15px; padding: 20px; border-radius: 15px; background: linear-gradient(135deg, #e8f5e9, #d4edda); border: 1px solid #698167; }
.info-card h4 { margin-top: 0; color: #698167; }

/* Feeding and Health */
.feed-log, .health-entry { border: 1px solid #e9ecef; border-radius: 12px; padding: 15px; margin: 10px 0; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
.feed-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f1f3f4; }
.feed-item:last-child { border-bottom: none; }
.feed-status { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
.status-pending { background: #fff3cd; color: #856404; }
.status-completed { background: #d1e7dd; color: #0f5132; }
.status-overdue { background: #f8d7da; color: #721c24; }

.next-feed { background: linear-gradient(135deg, #e3f2fd, #bbdefb); border: 1px solid #2196f3; padding: 15px; border-radius: 12px; margin: 15px 0; }

/* Condition Grid */
.condition-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; margin: 15px 0; }
.condition-item { text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
.condition-value { font-weight: bold; font-size: 20px; margin-top: 5px; }
.condition-poor { color: #dc3545; }
.condition-fair { color: #ffc107; }
.condition-good { color: #28a745; }

/* Modal Styles */
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); justify-content: center; align-items: center; z-index: 1000; }
.modal-content { background: white; padding: 30px; border-radius: 20px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
.modal-content h3 { margin-top: 0; color: #698167; }
.modal-buttons { margin-top: 20px; text-align: right; }

/* Export Section */
.export-section { margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 15px; }

/* Responsive Design */
@media (max-width: 768px) {
  .main-nav { 
    padding: 10px 5px;
    gap: 5px;
  }
  .nav-tab { 
    margin: 0 2px; 
    padding: 10px 12px; 
    min-width: 70px;
    font-size: 11px;
  }
  .nav-tab .tab-icon { font-size: 16px; }
  .nav-tab .tab-text { font-size: 10px; }
  .animal-grid { grid-template-columns: 1fr; }
  .condition-grid { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 480px) {
  .nav-tab {
    min-width: 60px;
    padding: 8px 10px;
  }
  .nav-tab .tab-text {
    font-size: 9px;
    line-height: 1.1;
  }
  .nav-tab .tab-icon { font-size: 14px; }
}

/* Loading Animation */
.loading { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; }
@keyframes spin { to { transform: rotate(360deg); } }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>

<div class="container">
  <div class="header">
      <img src="Bush (2).png" alt="Site Logo" /><h1>BushBuddy</h1>
    <p>Professional Wildlife Care Management System</p>
  </div>

  <!-- Main Navigation with Icons -->
  <div class="main-nav">
    <button class="nav-tab active" onclick="showMainTab('animals')">
      <div class="tab-icon">ü¶ò</div>
      <div class="tab-text">Animal<br>Management</div>
    </button>
    <button class="nav-tab" onclick="showMainTab('weight')">
      <div class="tab-icon">‚öñÔ∏è</div>
      <div class="tab-text">Weight &<br>Feed</div>
    </button>
    <button class="nav-tab" onclick="showMainTab('feeding')">
      <div class="tab-icon">üçΩÔ∏è</div>
      <div class="tab-text">Feeding<br>Log</div>
    </button>
    <button class="nav-tab" onclick="showMainTab('health')">
      <div class="tab-icon">‚ù§Ô∏è</div>
      <div class="tab-text">Health<br>Tracking</div>
    </button>
    <button class="nav-tab" onclick="showMainTab('photos')">
      <div class="tab-icon">üì∑</div>
      <div class="tab-text">Photo<br>Gallery</div>
    </button>
    <button class="nav-tab" onclick="showMainTab('export')">
      <div class="tab-icon">üìã</div>
      <div class="tab-text">Care<br>Handover</div>
    </button>
  </div>

  <!-- Animal Management Tab -->
  <div id="animalsTab" class="tab-content active">
    <div class="card">
      <h2>Add New Animal</h2>
      <label>Name: <input type="text" id="animalName" placeholder="Enter animal name"></label>
      <label>Species: 
        <select id="animalSpecies">
          <option value="Common Brushtail Possum">Common Brushtail Possum</option>
          <option value="Ringtail Possum">Ringtail Possum</option>
          <option value="Short-Eared Brushtail Possum">Short-Eared Brushtail Possum</option>
        </select>
      </label>
      <label>Intake Date: <input type="date" id="intakeDate"></label>
      <label>Intake Notes: <textarea id="intakeNotes" placeholder="Circumstances of rescue, initial condition, etc."></textarea></label>
      <button onclick="addAnimal()">Add Animal</button>
    </div>

    <div class="card">
      <h2>Your Animals</h2>
      <div id="animalList" class="animal-grid"></div>
    </div>
  </div>

  <!-- Weight & Feed Tab -->
  <div id="weightTab" class="tab-content">
    <div class="card">
      <h2>Weight Tracking & Feed Calculator</h2>
      <label>Select Animal: <select id="animalSelect"></select></label>
      <label>Date: <input type="date" id="weightDate"></label>
      <label>Weight (g): 
        <input type="number" id="animalWeight" placeholder="Enter weight in grams" 
               oninput="updateFeedCalculation()">
      </label>
      <button onclick="addWeight()">Add Weight</button>
      <div class="result" id="feedResult"></div>
      <div class="info-card" id="infoCard" style="display: none;"></div>
      <div id="weightHistory"></div>
      <canvas id="weightChart" style="max-height: 400px;"></canvas>
    </div>
  </div>

  <!-- Feeding Log Tab -->
  <div id="feedingTab" class="tab-content">
    <div class="card">
      <h2>Daily Feeding Log</h2>
      <label>Select Animal: <select id="feedingAnimalSelect"></select></label>
      <div class="next-feed" id="nextFeedInfo"></div>
      <div id="todayFeedings"></div>
      <h4>Feeding History</h4>
      <div id="feedingHistory"></div>
    </div>
  </div>

  <!-- Health Tracking Tab -->
  <div id="healthTab" class="tab-content">
    <div class="card">
      <h2>Health Condition Tracking</h2>
      <label>Select Animal: <select id="healthAnimalSelect"></select></label>
      <label>Date: <input type="date" id="healthDate"></label>
      <div class="condition-grid">
        <div class="condition-item">
          <label>Body Condition:</label>
          <select id="bodyCondition">
            <option value="poor">Poor</option>
            <option value="fair">Fair</option>
            <option value="good" selected>Good</option>
          </select>
        </div>
    `).join('');
}

function deleteWeight(id) {
  weightData = weightData.filter(w => w.id !== id);
  localStorage.setItem('bushbuddy_weights', JSON.stringify(weightData));
  updateWeightHistory();
  updateWeightChart();
}

let weightChart;

function updateWeightChart() {
  const animalId = document.getElementById('animalSelect').value;
  const canvas = document.getElementById('weightChart');
  
  if (weightChart) {
    weightChart.destroy();
  }
  
  if (!animalId) return;
  
  const weights = weightData
    .filter(w => w.animalId === animalId)
    .sort((a, b) => new Date(a.date) - new Date(b.date));
  
  const ctx = canvas.getContext('2d');
  weightChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: weights.map(w => formatDateForDisplay(w.date)),
      datasets: [{
        label: 'Weight (g)',
        data: weights.map(w => w.weight),
        borderColor: '#698167',
        backgroundColor: 'rgba(105, 129, 103, 0.1)',
        borderWidth: 3,
        fill: true,
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Weight (grams)'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Date'
          }
        }
      },
      plugins: {
        title: {
          display: true,
          text: 'Weight Progress'
        }
      }
    }
  });
}

// Feeding Management
function updateFeedingDisplay() {
  const animalId = document.getElementById('feedingAnimalSelect').value;
  
  if (!animalId) {
    document.getElementById('nextFeedInfo').innerHTML = '';
    document.getElementById('todayFeedings').innerHTML = '';
    document.getElementById('feedingHistory').innerHTML = '';
    return;
  }
  
  updateNextFeedInfo(animalId);
  updateTodayFeedings(animalId);
  updateFeedingHistory(animalId);
}

function updateNextFeedInfo(animalId) {
  const animal = animals.find(a => a.id === animalId);
  const latestWeight = weightData
    .filter(w => w.animalId === animalId)
    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
  
  const nextFeedDiv = document.getElementById('nextFeedInfo');
  
  if (!latestWeight) {
    nextFeedDiv.innerHTML = '<p>Please add weight data to get feeding recommendations.</p>';
    return;
  }
  
  let feedAmount, feedFrequency;
  
  if (animal.species === 'Common Brushtail Possum') {
    if (latestWeight.weight < 100) {
      feedAmount = Math.round(latestWeight.weight * 0.15);
      feedFrequency = 2;
    } else if (latestWeight.weight < 300) {
      feedAmount = Math.round(latestWeight.weight * 0.12);
      feedFrequency = 3;
    } else if (latestWeight.weight < 800) {
      feedAmount = Math.round(latestWeight.weight * 0.1);
      feedFrequency = 4;
    } else {
      feedAmount = Math.round(latestWeight.weight * 0.08);
      feedFrequency = 6;
    }
  } else {
    feedAmount = Math.round(latestWeight.weight * 0.1);
    feedFrequency = 4;
  }
  
  const lastFeed = feedingData
    .filter(f => f.animalId === animalId && f.status === 'completed')
    .sort((a, b) => new Date(b.datetime) - new Date(a.datetime))[0];
  
  let nextFeedTime = 'Now';
  if (lastFeed) {
    const nextTime = new Date(lastFeed.datetime);
    nextTime.setHours(nextTime.getHours() + feedFrequency);
    if (nextTime > new Date()) {
      nextFeedTime = nextTime.toLocaleString('en-GB');
    }
  }
  
  nextFeedDiv.innerHTML = `
    <h4>Next Feeding for ${animal.name}</h4>
    <p><strong>Amount:</strong> ${feedAmount}ml</p>
    <p><strong>Next Feed:</strong> ${nextFeedTime}</p>
    <button onclick="recordFeeding('${animalId}', ${feedAmount})">Record Feeding Now</button>
  `;
}

function recordFeeding(animalId, amount) {
  const feeding = {
    id: Date.now().toString(),
    animalId,
    datetime: new Date().toISOString(),
    amount,
    status: 'completed',
    notes: ''
  };
  
  feedingData.push(feeding);
  localStorage.setItem('bushbuddy_feeding', JSON.stringify(feedingData));
  updateFeedingDisplay();
}

function updateTodayFeedings(animalId) {
  const today = new Date().toDateString();
  const todayFeedings = feedingData
    .filter(f => f.animalId === animalId && new Date(f.datetime).toDateString() === today)
    .sort((a, b) => new Date(b.datetime) - new Date(a.datetime));
  
  const todayDiv = document.getElementById('todayFeedings');
  
  if (todayFeedings.length === 0) {
    todayDiv.innerHTML = '<h4>No feedings recorded today</h4>';
    return;
  }
  
  todayDiv.innerHTML = `
    <h4>Today's Feedings</h4>
    ${todayFeedings.map(f => `
      <div class="feed-item">
        <div>
          <strong>${new Date(f.datetime).toLocaleTimeString('en-GB')}</strong> - ${f.amount}ml
          ${f.notes ? `<br><small>${f.notes}</small>` : ''}
        </div>
        <button class="small danger" onclick="deleteFeeding('${f.id}')">Delete</button>
      </div>
    `).join('')}
  `;
}

function updateFeedingHistory(animalId) {
  const feedings = feedingData
    .filter(f => f.animalId === animalId)
    .sort((a, b) => new Date(b.datetime) - new Date(a.datetime))
    .slice(0, 10); // Show last 10 feedings
  
  const historyDiv = document.getElementById('feedingHistory');
  
  historyDiv.innerHTML = feedings.map(f => `
    <div class="feed-log">
      <strong>${formatDateForDisplay(f.datetime)} ${new Date(f.datetime).toLocaleTimeString('en-GB')}</strong>
      <br>Amount: ${f.amount}ml
      ${f.notes ? `<br>Notes: ${f.notes}` : ''}
    </div>
  `).join('');
}

function deleteFeeding(id) {
  feedingData = feedingData.filter(f => f.id !== id);
  localStorage.setItem('bushbuddy_feeding', JSON.stringify(feedingData));
  updateFeedingDisplay();
}

// Health Management
function addHealthEntry() {
  const animalId = document.getElementById('healthAnimalSelect').value;
  const date = document.getElementById('healthDate').value;
  const bodyCondition = document.getElementById('bodyCondition').value;
  const alertness = document.getElementById('alertness').value;
  const appetite = document.getElementById('appetite').value;
  const temperature = document.getElementById('temperature').value;
  const notes = document.getElementById('healthNotes').value;
  
  if (!animalId || !date) {
    alert('Please select an animal and date');
    return;
  }
  
  const healthEntry = {
    id: Date.now().toString(),
    animalId,
    date,
    bodyCondition,
    alertness,
    appetite,
    temperature: temperature ? parseFloat(temperature) : null,
    notes,
    created: new Date().toISOString()
  };
  
  healthData.push(healthEntry);
  localStorage.setItem('bushbuddy_health', JSON.stringify(healthData));
  
  document.getElementById('healthDate').value = '';
  document.getElementById('temperature').value = '';
  document.getElementById('healthNotes').value = '';
  
  updateHealthDisplay();
}

function updateHealthDisplay() {
  const animalId = document.getElementById('healthAnimalSelect').value;
  const historyDiv = document.getElementById('healthHistory');
  
  if (!animalId) {
    historyDiv.innerHTML = '';
    return;
  }
  
  const entries = healthData
    .filter(h => h.animalId === animalId)
    .sort((a, b) => new Date(b.date) - new Date(a.date));
  
  historyDiv.innerHTML = '<h4>Health History</h4>' +
    entries.map(entry => `
      <div class="health-entry">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h5>${formatDateForDisplay(entry.date)}</h5>
          <button class="small danger" onclick="deleteHealthEntry('${entry.id}')">Delete</button>
        </div>
        <div class="condition-grid">
          <div class="condition-item">
            <div class="condition-label">Body Condition</div>
            <div class="condition-value condition-${entry.bodyCondition}">${entry.bodyCondition.toUpperCase()}</div>
          </div>
          <div class="condition-item">
            <div class="condition-label">Alertness</div>
            <div class="condition-value condition-${entry.alertness}">${entry.alertness.toUpperCase()}</div>
          </div>
          <div class="condition-item">
            <div class="condition-label">Appetite</div>
            <div class="condition-value condition-${entry.appetite}">${entry.appetite.toUpperCase()}</div>
          </div>
          ${entry.temperature ? `
            <div class="condition-item">
              <div class="condition-label">Temperature</div>
              <div class="condition-value">${entry.temperature}¬∞C</div>
            </div>
          ` : ''}
        </div>
        ${entry.notes ? `<p><strong>Notes:</strong> ${entry.notes}</p>` : ''}
      </div>
    `).join('');
}

function deleteHealthEntry(id) {
  healthData = healthData.filter(h => h.id !== id);
  localStorage.setItem('bushbuddy_health', JSON.stringify(healthData));
  updateHealthDisplay();
}

// Photo Management
function updatePhotoGallery() {
  const animalId = document.getElementById('photoAnimalSelect').value;
  const galleryDiv = document.getElementById('photoGallery');
  
  if (!animalId) {
    galleryDiv.innerHTML = '';
    return;
  }
  
  const photos = photoData.filter(p => p.animalId === animalId);
  
  galleryDiv.innerHTML = photos.map(photo => `
    <div class="photo-item">
      <img src="${photo.data}" alt="Animal photo">
      <button class="photo-delete" onclick="deletePhoto('${photo.id}')">√ó</button>
      <div class="photo-info">
        <div><strong>${formatDateForDisplay(photo.created)}</strong></div>
        ${photo.notes ? `<div>${photo.notes}</div>` : ''}
      </div>
    </div>
  `).join('');
}

// Photo handling
document.getElementById('photoInput').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  const reader = new FileReader();
  reader.onload = function(e) {
    const preview = document.getElementById('photoPreview');
    preview.innerHTML = `<img src="${e.target.result}" class="photo-preview" alt="Photo preview">`;
    document.getElementById('savePhotoBtn').style.display = 'inline-block';
    document.getElementById('savePhotoBtn').dataset.photoData = e.target.result;
  };
  reader.readAsDataURL(file);
});

function savePhoto() {
  const animalId = document.getElementById('photoAnimalSelect').value;
  const notes = document.getElementById('photoNotes').value;
  const photoData = document.getElementById('savePhotoBtn').dataset.photoData;
  
  if (!animalId || !photoData) {
    alert('Please select an animal and take a photo');
    return;
  }
  
  const photo = {
    id: Date.now().toString(),
    animalId,
    data: photoData,
    notes,
    created: new Date().toISOString()
  };
  
  photoData.push(photo);
  localStorage.setItem('bushbuddy_photos', JSON.stringify(photoData));
  
  document.getElementById('photoNotes').value = '';
  document.getElementById('photoPreview').innerHTML = '';
  document.getElementById('savePhotoBtn').style.display = 'none';
  document.getElementById('photoInput').value = '';
  
  updatePhotoGallery();
}

function deletePhoto(id) {
  if (!confirm('Delete this photo?')) return;
  
  photoData = photoData.filter(p => p.id !== id);
  localStorage.setItem('bushbuddy_photos', JSON.stringify(photoData));
  updatePhotoGallery();
}

// Export/Import Functions
function exportAnimalData() {
  const animalId = document.getElementById('exportAnimalSelect').value;
  if (!animalId) {
    alert('Please select an animal');
    return;
  }
  
  const animal = animals.find(a => a.id === animalId);
  const weights = weightData.filter(w => w.animalId === animalId);
  const feedings = feedingData.filter(f => f.animalId === animalId);
  const health = healthData.filter(h => h.animalId === animalId);
  const photos = photoData.filter(p => p.animalId === animalId);
  
  const exportData = {
    animal,
    weights,
    feedings,
    health,
    photos,
    exportDate: new Date().toISOString()
  };
  
  const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `${animal.name}_care_data_${formatDateForDisplay(new Date().toISOString()).replace(/\//g, '-')}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function exportAllData() {
  const exportData = {
    animals,
    weights: weightData,
    feedings: feedingData,
    health: healthData,
    photos: photoData,
    exportDate: new Date().toISOString()
  };
  
  const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `bushbuddy_backup_${formatDateForDisplay(new Date().toISOString()).replace(/\//g, '-')}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function restoreData() {
  const fileInput = document.getElementById('restoreInput');
  const file = fileInput.files[0];
  
  if (!file) {
    alert('Please select a backup file');
    return;
  }
  
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      
      if (confirm('This will replace all current data. Are you sure?')) {
        animals = data.animals || [];
        weightData = data.weights || [];
        feedingData = data.feedings || [];
        healthData = data.health || [];
        photoData = data.photos || [];
        
        localStorage.setItem('bushbuddy_animals', JSON.stringify(animals));
        localStorage.setItem('bushbuddy_weights', JSON.stringify(weightData));
        localStorage.setItem('bushbuddy_feeding', JSON.stringify(feedingData));
        localStorage.setItem('bushbuddy_health', JSON.stringify(healthData));
        localStorage.setItem('bushbuddy_photos', JSON.stringify(photoData));
        
        displayAnimals();
        updateAnimalSelects();
        alert('Data restored successfully!');
      }
    } catch (error) {
      alert('Invalid backup file');
    }
  };
  reader.readAsText(file);
}

// Initialize app
function initApp() {
  // Set today's date as default for date inputs
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('intakeDate').value = today;
  document.getElementById('weightDate').value = today;
  document.getElementById('healthDate').value = today;
  
  displayAnimals();
  updateAnimalSelects();
}

// Start the app when page loads
document.addEventListener('DOMContentLoaded', initApp);
</script>

</body>
</html>
        <div class="condition-item">
          <label>Alertness:</label>
          <select id="alertness">
            <option value="poor">Poor</option>
            <option value="fair">Fair</option>
            <option value="good" selected>Good</option>
          </select>
        </div>
        <div class="condition-item">
          <label>Appetite:</label>
          <select id="appetite">
            <option value="poor">Poor</option>
            <option value="fair">Fair</option>
            <option value="good" selected>Good</option>
          </select>
        </div>
        <div class="condition-item">
          <label>Temperature (¬∞C):</label>
          <input type="number" id="temperature" step="0.1" placeholder="e.g. 36.5">
        </div>
      </div>
      <label>Health Notes: <textarea id="healthNotes" placeholder="Observations, concerns, treatments..."></textarea></label>
      <button onclick="addHealthEntry()">Add Health Entry</button>
      <div id="healthHistory"></div>
    </div>
  </div>

  <!-- Photo Gallery Tab -->
  <div id="photosTab" class="tab-content">
    <div class="card">
      <h2>Photo Gallery</h2>
      <label>Select Animal: <select id="photoAnimalSelect"></select></label>
      
      <div class="photo-section">
        <h4>Add New Photo</h4>
        <input type="file" id="photoInput" accept="image/*">
        <button onclick="document.getElementById('photoInput').click()">Take/Select Photo</button>
        <div id="photoPreview"></div>
        <label>Photo Notes: <input type="text" id="photoNotes" placeholder="Description, date, observations..."></label>
        <button onclick="savePhoto()" id="savePhotoBtn" style="display: none;">Save Photo</button>
      </div>

      <div id="photoGallery" class="photo-grid"></div>
    </div>
  </div>

  <!-- Care Handover Tab -->
  <div id="exportTab" class="tab-content">
    <div class="card">
      <h2>Care Handover</h2>
      <label>Select Animal for Export: 
        <select id="exportAnimalSelect">
          <option value="">Select an animal...</option>
        </select>
      </label>
      <button onclick="exportAnimalData()" class="secondary">Export Care Data</button>
      
      <div class="export-section">
        <h4>Backup & Restore</h4>
        <button onclick="exportAllData()" class="secondary">Backup All Data</button>
        <label>Restore Data: <input type="file" id="restoreInput" accept=".json"></label>
        <button onclick="restoreData()">Restore from Backup</button>
      </div>
    </div>
  </div>

</div>

<script>
// Data Storage
let animals = JSON.parse(localStorage.getItem('bushbuddy_animals') || '[]');
let weightData = JSON.parse(localStorage.getItem('bushbuddy_weights') || '[]');
let feedingData = JSON.parse(localStorage.getItem('bushbuddy_feeding') || '[]');
let healthData = JSON.parse(localStorage.getItem('bushbuddy_health') || '[]');
let photoData = JSON.parse(localStorage.getItem('bushbuddy_photos') || '[]');

// Date Formatting Functions
function formatDateForInput(dateStr) {
  if (!dateStr) return '';
  const date = new Date(dateStr);
  return date.toISOString().split('T')[0];
}

function formatDateForDisplay(dateStr) {
  if (!dateStr) return '';
  const date = new Date(dateStr);
  return date.toLocaleDateString('en-GB'); // dd/mm/yyyy format
}

function parseInputDate(inputDate) {
  // Convert from YYYY-MM-DD to Date object
  return new Date(inputDate);
}

// Tab Management
function showMainTab(tabName) {
  document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
  
  document.getElementById(tabName + 'Tab').classList.add('active');
  event.target.classList.add('active');
  
  if (tabName === 'weight' || tabName === 'feeding' || tabName === 'health' || tabName === 'photos' || tabName === 'export') {
    updateAnimalSelects();
  }
  
  if (tabName === 'weight') {
    updateWeightChart();
  } else if (tabName === 'feeding') {
    updateFeedingDisplay();
  } else if (tabName === 'health') {
    updateHealthDisplay();
  } else if (tabName === 'photos') {
    updatePhotoGallery();
  }
}

// Animal Management
function addAnimal() {
  const name = document.getElementById('animalName').value;
  const species = document.getElementById('animalSpecies').value;
  const intakeDate = document.getElementById('intakeDate').value;
  const intakeNotes = document.getElementById('intakeNotes').value;
  
  if (!name || !intakeDate) {
    alert('Please fill in all required fields');
    return;
  }
  
  const animal = {
    id: Date.now().toString(),
    name,
    species,
    intakeDate,
    intakeNotes,
    created: new Date().toISOString()
  };
  
  animals.push(animal);
  localStorage.setItem('bushbuddy_animals', JSON.stringify(animals));
  
  document.getElementById('animalName').value = '';
  document.getElementById('intakeDate').value = '';
  document.getElementById('intakeNotes').value = '';
  
  displayAnimals();
}

function displayAnimals() {
  const animalList = document.getElementById('animalList');
  animalList.innerHTML = animals.map(animal => `
    <div class="animal-item">
      <div class="animal-actions">
        <button class="small danger" onclick="deleteAnimal('${animal.id}')">Delete</button>
      </div>
      <h4>${animal.name}</h4>
      <p><strong>Species:</strong> ${animal.species}</p>
      <p><strong>Intake Date:</strong> ${formatDateForDisplay(animal.intakeDate)}</p>
      <p><strong>Notes:</strong> ${animal.intakeNotes}</p>
    </div>
  `).join('');
}

function deleteAnimal(id) {
  if (!confirm('Are you sure you want to delete this animal and all associated data?')) return;
  
  animals = animals.filter(a => a.id !== id);
  weightData = weightData.filter(w => w.animalId !== id);
  feedingData = feedingData.filter(f => f.animalId !== id);
  healthData = healthData.filter(h => h.animalId !== id);
  photoData = photoData.filter(p => p.animalId !== id);
  
  localStorage.setItem('bushbuddy_animals', JSON.stringify(animals));
  localStorage.setItem('bushbuddy_weights', JSON.stringify(weightData));
  localStorage.setItem('bushbuddy_feeding', JSON.stringify(feedingData));
  localStorage.setItem('bushbuddy_health', JSON.stringify(healthData));
  localStorage.setItem('bushbuddy_photos', JSON.stringify(photoData));
  
  displayAnimals();
  updateAnimalSelects();
}

function updateAnimalSelects() {
  const selects = ['animalSelect', 'feedingAnimalSelect', 'healthAnimalSelect', 'photoAnimalSelect', 'exportAnimalSelect'];
  selects.forEach(selectId => {
    const select = document.getElementById(selectId);
    if (select) {
      const currentValue = select.value;
      select.innerHTML = '<option value="">Select an animal...</option>' +
        animals.map(animal => `<option value="${animal.id}">${animal.name}</option>`).join('');
      if (animals.find(a => a.id === currentValue)) {
        select.value = currentValue;
      }
    }
  });
}

// Weight Management
function addWeight() {
  const animalId = document.getElementById('animalSelect').value;
  const date = document.getElementById('weightDate').value;
  const weight = parseFloat(document.getElementById('animalWeight').value);
  
  if (!animalId || !date || !weight) {
    alert('Please fill in all fields');
    return;
  }
  
  const weightEntry = {
    id: Date.now().toString(),
    animalId,
    date,
    weight,
    created: new Date().toISOString()
  };
  
  weightData.push(weightEntry);
  localStorage.setItem('bushbuddy_weights', JSON.stringify(weightData));
  
  document.getElementById('weightDate').value = '';
  document.getElementById('animalWeight').value = '';
  
  updateWeightHistory();
  updateWeightChart();
  updateFeedCalculation();
}

function updateFeedCalculation() {
  const weight = parseFloat(document.getElementById('animalWeight').value);
  const animalId = document.getElementById('animalSelect').value;
  const resultDiv = document.getElementById('feedResult');
  const infoCard = document.getElementById('infoCard');
  
  if (!weight || !animalId) {
    resultDiv.innerHTML = '';
    infoCard.style.display = 'none';
    return;
  }
  
  const animal = animals.find(a => a.id === animalId);
  if (!animal) return;
  
  let feedAmount, feedFrequency, milkAmount;
  let info = '';
  
  if (animal.species === 'Common Brushtail Possum') {
    if (weight < 100) {
      feedAmount = Math.round(weight * 0.15);
      feedFrequency = '2-3 hours';
      milkAmount = Math.round(weight * 0.1);
      info = 'Very young possum - needs frequent feeding and warmth. Use possum milk replacer.';
    } else if (weight < 300) {
      feedAmount = Math.round(weight * 0.12);
      feedFrequency = '3-4 hours';
      milkAmount = Math.round(weight * 0.08);
      info = 'Growing possum - introduce soft fruits alongside milk.';
    } else if (weight < 800) {
      feedAmount = Math.round(weight * 0.1);
      feedFrequency = '4-6 hours';
      info = 'Juvenile possum - transitioning to solid foods. Offer native fruits, vegetables.';
    } else {
      feedAmount = Math.round(weight * 0.08);
      feedFrequency = '6-8 hours';
      info = 'Adult possum - mainly solid foods. Prepare for release assessment.';
    }
  } else {
    // Generic calculation for other species
    feedAmount = Math.round(weight * 0.1);
    feedFrequency = '4-6 hours';
    info = 'General feeding guidelines - adjust based on species-specific requirements.';
  }
  
  resultDiv.innerHTML = `
    <h4>Feeding Recommendation</h4>
    <p><strong>Feed Amount:</strong> ${feedAmount}ml per feeding</p>
    <p><strong>Frequency:</strong> Every ${feedFrequency}</p>
    ${milkAmount ? `<p><strong>Milk Amount:</strong> ${milkAmount}ml</p>` : ''}
  `;
  
  infoCard.innerHTML = `<h4>Care Notes</h4><p>${info}</p>`;
  infoCard.style.display = 'block';
}

function updateWeightHistory() {
  const animalId = document.getElementById('animalSelect').value;
  const historyDiv = document.getElementById('weightHistory');
  
  if (!animalId) {
    historyDiv.innerHTML = '';
    return;
  }
  
  const weights = weightData
    .filter(w => w.animalId === animalId)
    .sort((a, b) => new Date(b.date) - new Date(a.date));
  
  historyDiv.innerHTML = '<h4>Weight History</h4>' +
    weights.map(w => `
      <div class="feed-log">
        <strong>${formatDateForDisplay(w.date)}:</strong> ${w.weight}g
        <button class="small danger" onclick="deleteWeight('${w.id}')">Delete</button>
      </div>
