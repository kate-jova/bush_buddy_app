<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BushBuddy</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#698167" />
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #f5f7fa 0%, #e7f5e4 100%); min-height: 100vh; }
.container { max-width: 1200px; margin: 0 auto; }
.header { text-align: center; margin-bottom: 30px; color: #657a6b; }
.header h1 { margin: 0; font-size: 2.5em; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }

/* Improved Navigation Tabs */
.main-nav { 
  display: flex; 
  justify-content: center; 
  margin-bottom: 30px; 
  background: white; 
  border-radius: 15px; 
  padding: 10px; 
  box-shadow: 0 8px 32px rgba(0,0,0,0.1); 
  backdrop-filter: blur(10px);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  -ms-overflow-style: none;
}
.main-nav::-webkit-scrollbar { display: none; }

.nav-tab { 
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 12px 16px; 
  margin: 0 4px; 
  border: none; 
  background: transparent; 
  color: #666; 
  cursor: pointer; 
  border-radius: 10px; 
  transition: all 0.3s ease; 
  font-weight: 600; 
  position: relative; 
  overflow: hidden;
  white-space: nowrap;
  min-width: 80px;
  font-size: 12px;
}

.nav-tab-icon {
  font-size: 20px;
  margin-bottom: 4px;
  transition: transform 0.3s ease;
}

.nav-tab-text {
  font-size: 11px;
  text-align: center;
  line-height: 1.2;
}

.nav-tab:hover { 
  background: rgba(43,122,120,0.1); 
  color: #657a6b; 
}

.nav-tab:hover .nav-tab-icon {
  transform: scale(1.1);
}

.nav-tab.active { 
  background: linear-gradient(135deg, #698167, #a0b2af); 
  color: white; 
  box-shadow: 0 4px 15px rgba(43,122,120,0.3); 
}

.nav-tab::before { 
  content: ''; 
  position: absolute; 
  top: 0; 
  left: -100%; 
  width: 100%; 
  height: 100%; 
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); 
  transition: left 0.5s; 
}

.nav-tab:hover::before { left: 100%; }

/* Card Styles */
.card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-bottom: 25px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
.card h2 { margin-top: 0; color: #698167; font-size: 1.8em; }
.card h3 { color: #698167; border-bottom: 2px solid #e8f5e9; padding-bottom: 10px; }

/* Form Elements - Improved for mobile */
label { display: block; margin-top: 15px; font-weight: 600; color: #555; }
input, select, textarea { 
  width: 100%; 
  padding: 12px; 
  margin-top: 6px; 
  border-radius: 10px; 
  border: 2px solid #e1e8ed; 
  box-sizing: border-box; 
  transition: all 0.3s ease; 
  font-size: 16px; /* Prevents zoom on iOS */
  -webkit-appearance: none; /* Better mobile styling */
}
input:focus, select:focus, textarea:focus { 
  outline: none; 
  border-color: #698167; 
  box-shadow: 0 0 0 3px rgba(43,122,120,0.1); 
}
textarea { resize: vertical; min-height: 80px; }

/* Buttons - Better mobile touch targets */
button { 
  margin: 8px 4px; 
  padding: 12px 20px; 
  border: none; 
  border-radius: 10px; 
  background: linear-gradient(135deg, #698167, #a0b2af); 
  color: white; 
  cursor: pointer; 
  font-weight: 600; 
  transition: all 0.3s ease; 
  position: relative; 
  overflow: hidden;
  min-height: 44px; /* Apple's recommended touch target */
  font-size: 14px;
}
button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(43,122,120,0.3); }
button:active { transform: translateY(0); }
button.secondary { background: linear-gradient(135deg, #6c757d, #7a8086); }
button.danger { background: linear-gradient(135deg, #dc3545, #e74c3c); }
button.small { padding: 8px 12px; font-size: 12px; margin: 2px; min-height: 36px; }
button::before { content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0; background: rgba(255,255,255,0.2); border-radius: 50%; transition: width 0.3s, height 0.3s; transform: translate(-50%, -50%); }
button:active::before { width: 300px; height: 300px; }

/* Photo Upload */
.photo-section { margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 15px; border: 2px dashed #dee2e6; text-align: center; }
.photo-preview { max-width: 200px; max-height: 200px; border-radius: 10px; margin: 10px; }
.photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 15px; }
.photo-item { position: relative; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
.photo-item img { width: 100%; height: 150px; object-fit: cover; }
.photo-item .photo-info { padding: 10px; font-size: 12px; color: #666; }
.photo-delete { position: absolute; top: 5px; right: 5px; background: rgba(220,53,69,0.9); color: white; border: none; border-radius: 50%; width: 30px; height: 30px; font-size: 14px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

/* Content Sections */
.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* Animal List - Improved grid */
.animal-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
.animal-item { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 6px 25px rgba(0,0,0,0.1); position: relative; }
.animal-item h4 { margin-top: 0; color: #698167; }
.animal-actions { position: absolute; top: 15px; right: 15px; display: flex; gap: 5px; }

/* Results and Info Cards */
.result { margin-top: 15px; padding: 15px; border-radius: 12px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-left: 4px solid #698167; }
.info-card { margin-top: 15px; padding: 20px; border-radius: 15px; background: linear-gradient(135deg, #e8f5e9, #d4edda); border: 1px solid #698167; }
.info-card h4 { margin-top: 0; color: #698167; }

/* Feeding and Health */
.feed-log, .health-entry { border: 1px solid #e9ecef; border-radius: 12px; padding: 15px; margin: 10px 0; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
.feed-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f1f3f4; }
.feed-item:last-child { border-bottom: none; }
.feed-status { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
.status-pending { background: #fff3cd; color: #856404; }
.status-completed { background: #d1e7dd; color: #0f5132; }
.status-overdue { background: #f8d7da; color: #721c24; }

.next-feed { background: linear-gradient(135deg, #e3f2fd, #bbdefb); border: 1px solid #2196f3; padding: 15px; border-radius: 12px; margin: 15px 0; }

/* Condition Grid */
.condition-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin: 15px 0; }
.condition-item { text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
.condition-value { font-weight: bold; font-size: 20px; margin-top: 5px; }
.condition-poor { color: #dc3545; }
.condition-fair { color: #ffc107; }
.condition-good { color: #28a745; }

/* Modal Styles */
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); justify-content: center; align-items: center; z-index: 1000; padding: 20px; box-sizing: border-box; }
.modal-content { background: white; padding: 30px; border-radius: 20px; max-width: 500px; width: 100%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
.modal-content h3 { margin-top: 0; color: #698167; }
.modal-buttons { margin-top: 20px; text-align: right; display: flex; gap: 10px; justify-content: flex-end; flex-wrap: wrap; }

/* Export Section */
.export-section { margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 15px; }

/* Responsive Design */
@media (max-width: 768px) {
  body { padding: 10px; }
  
  .header h1 { font-size: 2em; }
  
  .main-nav { 
    padding: 8px; 
    margin-bottom: 20px;
  }
  
  .nav-tab { 
    padding: 10px 12px; 
    margin: 0 2px;
    min-width: 70px;
  }
  
  .nav-tab-icon {
    font-size: 18px;
    margin-bottom: 3px;
  }
  
  .nav-tab-text {
    font-size: 10px;
  }
  
  .card { padding: 20px; }
  
  .animal-grid { grid-template-columns: 1fr; }
  
  .condition-grid { grid-template-columns: repeat(2, 1fr); }
  
  .photo-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); }
  
  .feed-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 10px;
  }
  
  .modal-content {
    padding: 20px;
    margin: 10px;
  }
  
  .modal-buttons {
    justify-content: stretch;
  }
  
  .modal-buttons button {
    flex: 1;
    margin: 5px 0;
  }
}

@media (max-width: 480px) {
  .nav-tab {
    min-width: 60px;
    padding: 8px 10px;
  }
  
  .nav-tab-icon {
    font-size: 16px;
  }
  
  .nav-tab-text {
    font-size: 9px;
  }
  
  .animal-actions {
    position: static;
    margin-bottom: 10px;
    display: flex;
    justify-content: flex-end;
  }
}

/* Loading Animation */
.loading { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

/* Accessibility improvements */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .nav-tab {
    border: 2px solid currentColor;
  }
  
  .card {
    border: 2px solid #333;
  }
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>

<div class="container">
  <div class="header">
      <img src="Bush (2).png" alt="Site Logo" /><h1>BushBuddy</h1>
    <p>Professional Wildlife Care Management System</p>
  </div>

  <!-- Improved Main Navigation with Icons -->
  <div class="main-nav">
    <button class="nav-tab active" onclick="showMainTab('animals')">
      <div class="nav-tab-icon">üêæ</div>
      <div class="nav-tab-text">Animal<br>Management</div>
    </button>
    <button class="nav-tab" onclick="showMainTab('weight')">
      <div class="nav-tab-icon">‚öñÔ∏è</div>
      <div class="nav-tab-text">Weight &<br>Feed</div>
    </button>
    <button class="nav-tab" onclick="showMainTab('feeding')">
      <div class="nav-tab-icon">üçº</div>
      <div class="nav-tab-text">Feeding<br>Log</div>
    </button>
    <button class="nav-tab" onclick="showMainTab('health')">
      <div class="nav-tab-icon">üè•</div>
      <div class="nav-tab-text">Health<br>Tracking</div>
    </button>
    <button class="nav-tab" onclick="showMainTab('photos')">
      <div class="nav-tab-icon">üì∑</div>
      <div class="nav-tab-text">Photo<br>Gallery</div>
    </button>
    <button class="nav-tab" onclick="showMainTab('export')">
      <div class="nav-tab-icon">üìã</div>
      <div class="nav-tab-text">Care<br>Handover</div>
    </button>
  </div>

  <!-- Animal Management Tab -->
  <div id="animalsTab" class="tab-content active">
    <div class="card">
      <h2>Add New Animal</h2>
      <label>Name: <input type="text" id="animalName" placeholder="Enter animal name"></label>
      <label>Species: 
        <select id="animalSpecies">
          <option value="Common Brushtail Possum">Common Brushtail Possum</option>
          <option value="Ringtail Possum">Ringtail Possum</option>
          <option value="Short-Eared Brushtail Possum">Short-Eared Brushtail Possum</option>
        </select>
      </label>
      <label>Intake Date: <input type="date" id="intakeDate"></label>
      <label>Intake Notes: <textarea id="intakeNotes" placeholder="Circumstances of rescue, initial condition, etc."></textarea></label>
      <button onclick="addAnimal()">Add Animal</button>
    </div>

    <div class="card">
      <h2>Your Animals</h2>
      <div id="animalList" class="animal-grid"></div>
    </div>
  </div>

  <!-- Weight & Feed Tab -->
  <div id="weightTab" class="tab-content">
    <div class="card">
      <h2>Weight Tracking & Feed Calculator</h2>
      <label>Select Animal: <select id="animalSelect"></select></label>
      <label>Date: <input type="date" id="weightDate"></label>
      <label>Weight (g): 
        <input type="number" id="animalWeight" placeholder="Enter weight in grams" 
               oninput="updateFeedCalculation()">
      </label>
      <button onclick="addWeight()">Add Weight</button>
      <div class="result" id="feedResult"></div>
      <div class="info-card" id="infoCard" style="display: none;"></div>
      <div id="weightHistory"></div>
      <canvas id="weightChart" style="max-height: 400px;"></canvas>
    </div>
  </div>

  <!-- Feeding Log Tab -->
  <div id="feedingTab" class="tab-content">
    <div class="card">
      <h2>Daily Feeding Log</h2>
      <label>Select Animal: <select id="feedingAnimalSelect"></select></label>
      <div class="next-feed" id="nextFeedInfo"></div>
      <div id="todayFeedings"></div>
      <h4>Feeding History</h4>
      <div id="feedingHistory"></div>
    </div>
  </div>

  <!-- Health Tracking Tab -->
  <div id="healthTab" class="tab-content">
    <div class="card">
      <h2>Health Condition Tracking</h2>
      <label>Select Animal: <select id="healthAnimalSelect"></select></label>
      <label>Date: <input type="date" id="healthDate"></label>
      <div class="condition-grid">
        <div class="condition-item">
          <label>Body Condition:</label>
          <select id="bodyCondition">
            <option value="poor">Poor</option>
            <option value="fair">Fair</option>
            <option value="good" selected>Good</option>
          </select>
        </div>
        <div class="condition-item">
          <label>Alertness:</label>
          <select id="alertness">
            <option value="poor">Poor</option>
            <option value="fair">Fair</option>
            <option value="good" selected>Good</option>
          </select>
        </div>
        <div class="condition-item">
          <label>Appetite:</label>
          <select id="appetite">
            <option value="poor">Poor</option>
            <option value="fair">Fair</option>
            <option value="good" selected>Good</option>
          </select>
        </div>
        <div class="condition-item">
          <label>Temperature (¬∞C):</label>
          <input type="number" id="temperature" step="0.1" placeholder="e.g. 36.5">
        </div>
      </div>
      <label>Health Notes: <textarea id="healthNotes" placeholder="Observations, concerns, treatments..."></textarea></label>
      <button onclick="addHealthEntry()">Add Health Entry</button>
      <div id="healthHistory"></div>
    </div>
  </div>

  <!-- Photo Gallery Tab -->
  <div id="photosTab" class="tab-content">
    <div class="card">
      <h2>Photo Gallery</h2>
      <label>Select Animal: <select id="photoAnimalSelect"></select></label>
      
      <div class="photo-section">
        <h4>Add New Photo</h4>
        <input type="file" id="photoInput" accept="image/*">
        <button onclick="document.getElementById('photoInput').click()">Take/Select Photo</button>
        <div id="photoPreview"></div>
        <label>Photo Notes: <input type="text" id="photoNotes" placeholder="Description, date, observations..."></label>
        <button onclick="savePhoto()" id="savePhotoBtn" style="display: none;">Save Photo</button>
      </div>

      <div id="photoGallery" class="photo-grid"></div>
    </div>
  </div>

  <!-- Care Handover Tab -->
  <div id="exportTab" class="tab-content">
    <div class="card">
      <h2>Care Handover</h2>
      <label>Select Animal for Export: 
        <select id="exportAnimalSelect">
          <option value="">Select an animal...</option>
        </select>
      </label>
      <button onclick="exportAnimalData()" class="secondary">Export Care Data</button>
      
      <div class="export-section">
        <h4>Backup & Restore</h4>
        <button onclick="exportAllData()" class="secondary">Backup All Data</button>
        <label>Restore Data: <input type="file" id="restoreInput" accept=".json"></label>
        <button onclick="restoreData()">Restore from Backup</button>
      </div>
    </div>
  </div>

</div>

<!-- Modals (same as before but with updated styling) -->
<div id="animalModal" class="modal">
  <div class="modal-content">
    <h3>Edit Animal</h3>
    <label>Name:<input type="text" id="modalAnimalName"></label>
    <label>Species:
      <select id="modalAnimalSpecies">
        <option value="Common Brushtail Possum">Common Brushtail Possum</option>
        <option value="Ringtail Possum">Ringtail Possum</option>
        <option value="Short-Eared Brushtail Possum">Short-Eared Brushtail Possum</option>
      </select>
    </label>
    <label>Intake Date:<input type="date" id="modalIntakeDate"></label>
    <label>Intake Notes:<textarea id="modalIntakeNotes"></textarea></label>
    <div class="modal-buttons">
      <button onclick="closeAnimalModal()">Cancel</button>
      <button onclick="saveAnimalEdit()">Save</button>
    </div>
  </div>
</div>

<div id="weightModal" class="modal">
  <div class="modal-content">
    <h3>Edit Weight</h3>
    <label>Date:<input type="date" id="modalWeightDate"></label>
    <label>Weight (g):<input type="number" id="modalWeightValue"></label>
    <div class="modal-buttons">
      <button onclick="closeWeightModal()">Cancel</button>
      <button onclick="saveWeightEdit()">Save</button>
    </div>
  </div>
</div>

<div id="feedModal" class="modal">
  <div class="modal-content">
    <h3>Record Feeding</h3>
    <p id="feedModalInfo"></p>
    <label>Time Fed:<input type="time" id="feedTime"></label>
    <label>Amount Fed (g):<input type="number" id="feedAmount" step="0.1"></label>
    <label>Notes:<textarea id="feedNotes" placeholder="Any observations..."></textarea></label>
    <div class="modal-buttons">
      <button onclick="closeFeedModal()">Cancel</button>
      <button onclick="saveFeedEntry()">Record Feed</button>
    </div>
  </div>
</div>

<script>
// --- Species Data ---
const speciesData = {
  "Common Brushtail Possum": [
    { weight: 900, feeds: 1, predictedAge: "7 months", features: "Fully independent from Mum in the wild. No human interaction.", housing: "Large outdoor release aviary (min 3m x 2m x 2m)", housingNotes: "Large outdoor release aviary (bigger is better) set up as above.", nativeFood: "Native diet as above. Small branchlets of leaf tip up to large branches with fresh leaf.", feedingNotes: "1 milk feed per day at dusk.", milkFormula: "Maximum 40mL per feed.", comments: "Start weaning off milk ‚Äì reduce gradually and monitor weight of possum weekly to ensure maintaining weight with reduced milk and increased foliage. If not, wait until weight stable before reducing milk again." },
    { weight: 500, feeds: 2, predictedAge: "5.5 - 6 months", features: "Would still cling to mother's back in wild. Should be getting very confident climbing around enclosure. Reduce human interaction at this point, or survival in the wild will be compromised.", housing: "Large outdoor release aviary (min 3m x 2m x 2m)", housingNotes: "Large outdoor release aviary, (minimum 3m x 2m x 2m) in natural surroundings. Nest box, food/ water high in aviary.", nativeFood: "Increase native food similar to that of the release site (if known). Large variety of fresh native vegetation (at least 6 varieties) each day placed in water containers for freshness. Browse should include branches with bark, leaves, buds, flowers, fruit, nuts, and seeds. ALL NATIVE. Also a variety of grasses, dandelion, fungi, insects.", feedingNotes: "2 milk feeds per day. Offer early morning and late evening. Late evening feed should be offered well after native diet has been provided.", milkFormula: "MAXIMUM of 40mls in a single feed. 15% of body weight divided equally over 2 feeds. Decrease to 10% of body weight as they enjoy more native foliage.", comments: "MAXIMUM of 40mls in a single feed." },
    { weight: 400, feeds: 3, predictedAge: "5 months", features: "Dense fur. Dark pellets. Still riding on Mum's back but more confident climbing on its own. Very active at night. Should be climbing on branches and ropes, not on wire.", housing: "Large indoor cage (1m x 1m x 1.2m)", housingNotes: "28¬∞C ‚Äì no artificial heat. Large cage (1m x 1m x 1.2m) or small walk-in aviary on sheltered verandah. Cage to include nest box, water dish and good variety of branches and ropes for climbing.", nativeFood: "Must be eating good variety of native vegetation cut fresh each day. Soft insects such as small grasshoppers, moths.", feedingNotes: "3 milk feeds per day. Offer early morning, mid afternoon and late evening. Lapping. Do not leave milk in with possums as it goes 'off' very quickly.", milkFormula: "Milk: 15% of body weight divided equally over 3 feeds", comments: "" },
    { weight: 250, feeds: 4, predictedAge: "4.5 months", features: "Short dense fur. Soft pellets. More confident out of mum's pouch. Riding on mum's back.", housing: "Carry cage of basket with secure lid and fine mesh", housingNotes: "28¬∞C ‚Äì no artificial heat should be necessary unless animal compromised. Variety of branches and ropes for climbing. Housed indoors. Coop cup with small amount of fresh water.", nativeFood: "Offer a good variety of native vegetation (at least 5 different species cut fresh each day). Fresh leaf tip. Offer soft insects such as tiny grasshoppers, moths.", feedingNotes: "4 feeds per day. Milk ‚Äì 6 hourly. Lapping from shallow jar lid or small bowl.", milkFormula: "Milk: 15% of body weight divided equally over 4 feeds", comments: "" },
    { weight: 150, feeds: 5, predictedAge: "4 months", features: "Fine soft fur, teeth. Darker tube-like faeces. Starting to explore a little outside of mum's pouch.", housing: "Carry cage of basket with secure lid and fine mesh", housingNotes: "30¬∞C check warmth. Carry cage or basket with secure lid and fine mesh. Hang pouch inside with a couple of sturdy branches. Housed indoors. Exploring cage.", nativeFood: "A small amount and variety of fresh native leaf tip after each feed.", feedingNotes: "5 feeds per day. Milk approximately 5 hourly. Lapping from shallow jar lid or small bowl.", milkFormula: "Milk: 15% of body weight divided equally over 5 feeds.", comments: "" },
    { weight: 100, feeds: 6, predictedAge: "3.5 months", features: "Cutting fur, eyes open. Thick, custard-like faeces. Permanently in Mum's pouch.", housing: "Carry cage of basket with secure lid and fine mesh", housingNotes: "30¬∞C Check warmth. Carry cage or basket with secure lid and fine mesh. Provide a couple of pouch 'caves'. Plenty of polar fleece/ flannelette cloths on base of cage to allow hiding for security. No threads
