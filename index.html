<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BushBuddy</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#698167" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="BushBuddy">
<link rel="apple-touch-icon" href="BushBuddy-192.png">
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('./sw.js').then(function(registration) {
      console.log('ServiceWorker registration successful');
    }).catch(function(err) {
      console.log('ServiceWorker registration failed: ', err);
    });
  });
}
</script>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: linear-gradient(135deg, #f5f7fa 0%, #e7f5e4 100%); min-height: 100vh; }
.container { max-width: 1200px; margin: 0 auto; }
.header { text-align: center; margin-bottom: 30px; color: #657a6b; }

/* Navigation */
.main-nav { display: flex; justify-content: center; margin-bottom: 30px; background: white; border-radius: 15px; padding: 10px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); overflow-x: auto; }
.nav-tab { display: flex; flex-direction: column; align-items: center; padding: 12px 16px; margin: 0 4px; border: none; background: transparent; color: #666; cursor: pointer; border-radius: 10px; transition: all 0.3s ease; font-weight: 600; min-width: 80px; font-size: 12px; }
.nav-tab-icon { font-size: 20px; margin-bottom: 4px; }
.nav-tab-text { font-size: 11px; text-align: center; line-height: 1.2; }
.nav-tab:hover { background: rgba(43,122,120,0.1); color: #657a6b; }
.nav-tab.active { background: linear-gradient(135deg, #698167, #a0b2af); color: white; box-shadow: 0 4px 15px rgba(43,122,120,0.3); }

/* Desktop larger tabs */
@media (min-width: 1025px) {
  .nav-tab { padding: 16px 20px; min-width: 100px; }
  .nav-tab-icon { font-size: 24px; margin-bottom: 6px; }
  .nav-tab-text { font-size: 12px; }
}

/* Tablet styles (iPad) - 769px to 1024px */
@media (min-width: 769px) and (max-width: 1024px) {
  .main-nav { justify-content: center; padding: 10px; }
  .nav-tab { padding: 16px 18px; min-width: 90px; margin: 0 4px; }
  .nav-tab-icon { font-size: 22px; margin-bottom: 5px; }
  .nav-tab-text { font-size: 11px; }
}

/* Mobile phones - up to 768px */
@media (max-width: 768px) {
  body { padding: 10px; }
  
  .header img {
    max-height: 80px;
    max-width: 90vw;
  }
  
  .main-nav { 
    padding: 6px; 
    overflow-x: auto; 
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    justify-content: flex-start;
    display: flex;
  }
  .main-nav::-webkit-scrollbar { display: none; }
  .nav-tab { 
    padding: 12px 8px; 
    margin: 0 1px; 
    min-width: 70px; 
    flex-shrink: 0;
  }
  .nav-tab-icon { font-size: 18px; margin-bottom: 3px; }
  .nav-tab-text { font-size: 9px; line-height: 1.1; }
  .card { padding: 20px; }
  .animal-grid { grid-template-columns: 1fr; }
}

/* Very small mobile - up to 480px */
@media (max-width: 480px) {
  .main-nav { padding: 4px; }
  .nav-tab { 
    padding: 10px 6px; 
    margin: 0 1px; 
    min-width: 65px;
  }
  .nav-tab-icon { font-size: 16px; margin-bottom: 2px; }
  .nav-tab-text { font-size: 8px; line-height: 1; }
}

/* Cards */
.card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-bottom: 25px; }
.card h2 { margin-top: 0; color: #698167; font-size: 1.8em; }

/* Forms */
label { display: block; margin-top: 15px; font-weight: 600; color: #555; }
input, select, textarea { width: 100%; padding: 12px; margin-top: 6px; border-radius: 10px; border: 2px solid #e1e8ed; box-sizing: border-box; font-size: 16px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; -webkit-appearance: none; -webkit-border-radius: 10px; }
input:focus, select:focus, textarea:focus { outline: none; border-color: #698167; box-shadow: 0 0 0 3px rgba(43,122,120,0.1); }
textarea { resize: vertical; min-height: 80px; }

/* iOS specific fixes */
input[type="number"] { -webkit-appearance: none; -moz-appearance: textfield; }
input[type="date"] { -webkit-appearance: none; }
input[type="file"] { -webkit-appearance: none; }

/* Prevent zoom on input focus for iOS */
@media screen and (max-width: 768px) {
  input, select, textarea { font-size: 16px; }
}

/* Buttons */
button { margin: 8px 4px; padding: 12px 20px; border: none; border-radius: 10px; background: linear-gradient(135deg, #698167, #a0b2af); color: white; cursor: pointer; font-weight: 600; transition: all 0.3s ease; min-height: 44px; font-size: 14px; }
button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(43,122,120,0.3); }
button.small { padding: 8px 12px; font-size: 12px; margin: 2px; min-height: 36px; }
button.danger { background: linear-gradient(135deg, #dc3545, #e74c3c); }

/* Content */
.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* Animal grid */
.animal-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
.animal-item { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 6px 25px rgba(0,0,0,0.1); position: relative; }
.animal-item h4 { margin-top: 0; color: #698167; }
.animal-actions { position: absolute; top: 15px; right: 15px; display: flex; gap: 5px; }

/* Results */
.result { margin-top: 15px; padding: 15px; border-radius: 12px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-left: 4px solid #698167; }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <img src="BushBuddy.png" alt="BushBuddy Logo" style="max-height: 120px; max-width: 100%; height: auto; margin-bottom: 0;">
  </div>

  <div class="main-nav">
    <button class="nav-tab active" onclick="showTab('animals')">
      <div class="nav-tab-icon">üêæ</div>
      <div class="nav-tab-text">Animal<br>Management</div>
    </button>
    <button class="nav-tab" onclick="showTab('weight')">
      <div class="nav-tab-icon">‚öñÔ∏è</div>
      <div class="nav-tab-text">Weight &<br>Feed</div>
    </button>
    <button class="nav-tab" onclick="showTab('health')">
      <div class="nav-tab-icon">üè•</div>
      <div class="nav-tab-text">Health<br>Tracking</div>
    </button>
    <button class="nav-tab" onclick="showTab('schedule')">
      <div class="nav-tab-icon">üìÖ</div>
      <div class="nav-tab-text">Feeding<br>Schedule</div>
    </button>
    <button class="nav-tab" onclick="showTab('gallery')">
      <div class="nav-tab-icon">üì∏</div>
      <div class="nav-tab-text">Photo<br>Gallery</div>
    </button>
    <button class="nav-tab" onclick="showTab('export')">
      <div class="nav-tab-icon">üìã</div>
      <div class="nav-tab-text">Care<br>Handover</div>
    </button>
  </div>

  <!-- Animals Tab -->
  <div id="animalsTab" class="tab-content active">
    <div class="card">
      <h2>Add New Animal</h2>
      <label>Name: <input type="text" id="animalName" placeholder="Enter animal name"></label>
      <label>Species: 
        <select id="animalSpecies">
          <option value="Common Brushtail Possum">Common Brushtail Possum</option>
          <option value="Ringtail Possum">Ringtail Possum</option>
          <option value="Short-Eared Brushtail Possum">Short-Eared Brushtail Possum</option>
        </select>
      </label>
      <label>Intake Date: <input type="date" id="intakeDate"></label>
      <label>Intake Notes: <textarea id="intakeNotes" placeholder="Circumstances of rescue, initial condition, etc."></textarea></label>
      <button onclick="addAnimal()">Add Animal</button>
    </div>

    <div class="card">
      <h2>Your Animals</h2>
      
      <!-- Search & Filter Controls -->
      <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
        <input type="text" id="animalSearch" placeholder="Search by name, species, or notes..." 
               style="flex: 1; min-width: 200px;">
        
        <select id="speciesFilter" 
                style="min-width: 200px; padding: 10px; border-radius: 10px; border: 2px solid #e1e8ed;">
          <option value="">All Species</option>
          <option value="Common Brushtail Possum">Common Brushtail Possum</option>
          <option value="Ringtail Possum">Ringtail Possum</option>
          <option value="Short-Eared Brushtail Possum">Short-Eared Brushtail Possum</option>
        </select>
      </div>
      
      <!-- Counter -->
      <p id="animalCounter" style="color: #666; font-size: 14px; margin-bottom: 10px;"></p>

      <div id="animalList" class="animal-grid">
        <p style="text-align: center; color: #666; font-style: italic;">No animals added yet. Add your first animal above!</p>
      </div>
    </div>
  </div>

  <!-- Weight Tab -->
  <div id="weightTab" class="tab-content">
    <div class="card">
      <h2>Weight Tracking & Feed Calculator</h2>
      <label>Select Animal: <select id="animalSelect" onchange="onAnimalSelectChange()"></select></label>
      <label>Date: <input type="date" id="weightDate"></label>
      <label>Weight (g): <input type="number" id="animalWeight" placeholder="Enter weight in grams" oninput="showFeedCalc()"></label>
      <button onclick="addWeight()">Add Weight</button>
      <div id="feedResult" class="result"></div>
      <div id="weightHistory" style="margin-top: 20px;"></div>
    </div>
  </div>

  <!-- Health Tab -->
  <div id="healthTab" class="tab-content">
    <div class="card">
      <h2>Health Condition Tracking</h2>
      <label>Select Animal: <select id="healthAnimalSelect" onchange="onHealthAnimalSelectChange()"></select></label>
      <label>Date: <input type="date" id="healthDate"></label>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin: 15px 0;">
        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
          <label>Body Condition:</label>
          <select id="bodyCondition">
            <option value="poor">Poor</option>
            <option value="fair">Fair</option>
            <option value="good" selected>Good</option>
          </select>
        </div>
        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
          <label>Alertness:</label>
          <select id="alertness">
            <option value="poor">Poor</option>
            <option value="fair">Fair</option>
            <option value="good" selected>Good</option>
          </select>
        </div>
        <div style="text-align: center; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
          <label>Appetite:</label>
          <select id="appetite">
            <option value="poor">Poor</option>
            <option value="fair">Fair</option>
            <option value="good" selected>Good</option>
          </select>
        </div>
      </div>
      <label>Health Notes: <textarea id="healthNotes" placeholder="Observations, concerns, treatments..."></textarea></label>
      <button onclick="addHealthEntry()">Add Health Entry</button>
      <div id="healthHistory" style="margin-top: 20px;"></div>
    </div>
  </div>

  <!-- Feeding Schedule Tab -->
  <div id="scheduleTab" class="tab-content">
    <div class="card">
      <h2>Feeding Schedule</h2>
      <label>Select Animal: <select id="scheduleAnimalSelect" onchange="onScheduleAnimalSelectChange()"></select></label>
      <div id="scheduleDisplay" style="margin-top: 20px;">
        <p style="text-align: center; color: #666; font-style: italic;">Select an animal to view feeding schedule</p>
      </div>
    </div>
  </div>

  <!-- Photo Gallery Tab -->
  <div id="galleryTab" class="tab-content">
    <div class="card">
      <h2>Photo Gallery</h2>
      <label>Select Animal: <select id="galleryAnimalSelect" onchange="onGalleryAnimalSelectChange()"></select></label>
      <div style="margin-top: 20px;">
        <label>Add Photo: <input type="file" id="photoInput" accept="image/*" multiple></label>
        <button onclick="addPhotos()">Add Photos</button>
      </div>
      <div id="photoGallery" style="margin-top: 20px;">
        <p style="text-align: center; color: #666; font-style: italic;">Select an animal to view photos</p>
      </div>
    </div>
  </div>

  <!-- Export Tab -->
  <div id="exportTab" class="tab-content">
    <div class="card">
      <h2>Care Handover</h2>
      <label>Select Animal for Export: <select id="exportAnimalSelect"><option value="">Select an animal...</option></select></label>
      <button onclick="exportAnimalData()">Export Care Data</button>
      
      <div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-radius: 15px;">
        <h4>Backup & Restore</h4>
        <button onclick="exportAllData()">Backup All Data</button>
        <label>Restore Data: <input type="file" id="restoreInput" accept=".json"></label>
        <button onclick="restoreData()">Restore from Backup</button>
      </div>
    </div>
  </div>
</div>

<footer style="margin-top: 50px; padding: 30px 20px; background: rgba(255,255,255,0.9); border-top: 1px solid #e0e0e0; text-align: center; font-size: 12px; color: #666;">
  <div style="max-width: 1200px; margin: 0 auto;">
    <p><strong>Disclaimer:</strong> BushBuddy is a record-keeping tool designed to assist qualified wildlife carers. This application does not provide veterinary or professional wildlife care advice. Always consult with licensed wildlife veterinarians and follow established wildlife care protocols.</p>
    <p style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e0e0e0;">¬© 2025 BushBuddy. All rights reserved.</p>
  </div>
</footer>

<script>
// Global variables
var animals = [];
var currentLightboxAnimal = null;
var currentPhotoIndex = 0;
